<UserControl x:Class="LChess.Views.Contents.AnalysisContentView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ui="clr-namespace:LChess.Custom.UI.Unit;assembly=LChess.Custom"
             xmlns:cvt="clr-namespace:LChess.Util.Converter;assembly=LChess.Util"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors">

    <UserControl.Resources>

        <Style x:Key="HistoryTextBlockStyle" TargetType="{x:Type TextBlock}">
            <Setter Property="FontSize" Value="25"/>
            <Setter Property="FontWeight" Value="ExtraBold"/>
        </Style>

        <Style x:Key="AnalysisButtonStyle" TargetType="{x:Type ui:LChessButton}">
            <Setter Property="Margin" Value="10"/>
            <Setter Property="FontSize" Value="25"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Height" Value="60"/>
        </Style>

        <cvt:StringMatchToVisibilityConverter x:Key="StringMatchToVisibilityConverter"/>

        <cvt:GameEndTypeToTextConverter x:Key="GameEndTypeToTextConverter"/>

        <cvt:WinnerColorToTextConverter x:Key="WinnerColorToTextConverter"/>

        <cvt:PrettyNotaionStringConverter x:Key="PrettyNotaionStringConverter"/>

    </UserControl.Resources>

    <Grid>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="350"/>
        </Grid.ColumnDefinitions>

        <ContentControl Grid.Column="0"
                        Content="{Binding ChessBoardContent}"/>

        <Grid Grid.Column="1"
              Background="SteelBlue">

            <Grid.RowDefinitions>
                <RowDefinition Height="150"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <StackPanel>
                
                <StackPanel Orientation="Horizontal"
                            Margin="5">

                    <TextBlock Style="{StaticResource HistoryTextBlockStyle}"
                               Text="소요시간 : "/>
                    
                    <TextBlock Style="{StaticResource HistoryTextBlockStyle}"
                               Text="{Binding CurrentAnalysisFile.GameResult.PlayTime, StringFormat='{}{0:mm}분{0:ss}초'}"/>

                </StackPanel>

                <StackPanel Orientation="Horizontal"
                            Margin="5">

                    <TextBlock Style="{StaticResource HistoryTextBlockStyle}"
                               Text="경기결과 : "/>

                    <TextBlock Style="{StaticResource HistoryTextBlockStyle}"
                               Text="{Binding CurrentAnalysisFile.GameResult.Winner, Converter={StaticResource WinnerColorToTextConverter}}"/>

                </StackPanel>

                <StackPanel Orientation="Horizontal"
                            Margin="5">

                    <TextBlock Style="{StaticResource HistoryTextBlockStyle}"
                               Text="종료사유 : "/>

                    <TextBlock Style="{StaticResource HistoryTextBlockStyle}"
                               Text="{Binding CurrentAnalysisFile.GameResult.Type, Converter={StaticResource GameEndTypeToTextConverter}}"/>

                </StackPanel>

            </StackPanel>

            <ScrollViewer Grid.Row="1"
                          VerticalScrollBarVisibility="Auto"
                          Background="#4F93CC">

                <ItemsControl ItemsSource="{Binding CurrentAnalysisFile.GameResult.Notation}">

                    <ItemsControl.ItemTemplate>
                        <DataTemplate>

                            <Border Background="#5AA8E8"
                                    CornerRadius="5"
                                    Margin="5"
                                    Cursor="Hand">

                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="MouseLeftButtonDown">                                        
                                        <i:InvokeCommandAction Command="{Binding DataContext.MoveNotationCommand, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"
                                                               CommandParameter="{Binding}"/>                                        
                                    </i:EventTrigger>                                    
                                </i:Interaction.Triggers>

                                <TextBlock Text="{Binding Path=Notation, Converter={StaticResource PrettyNotaionStringConverter}}"
                                           Foreground="LightCyan"
                                           Margin="10"
                                           FontSize="16"
                                           FontWeight="Bold"/>

                            </Border>

                        </DataTemplate>
                    </ItemsControl.ItemTemplate>

                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                </ItemsControl>

            </ScrollViewer>

            <StackPanel Grid.Row="2">

                <ui:LChessButton Content="현재상태로 게임진행"
                                 Style="{StaticResource AnalysisButtonStyle}"
                                 Command="{Binding MoveToGameCommand}"/>

                <ui:LChessButton Content="홈으로"
                                 Style="{StaticResource AnalysisButtonStyle}"
                                 Command="{Binding MoveToHomeCommand}"/>

            </StackPanel>

        </Grid>

    </Grid>

</UserControl>
